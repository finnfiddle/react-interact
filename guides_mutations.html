<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Interact</title>
    <link rel="stylesheet" href="/react-interact//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css">
    <link rel="stylesheet" href="/react-interact/css/main.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header"><a href="/react-interact/" class="navbar-brand">Interact</a></div>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/react-interact/">Home</a></li>
          <li><a href="/react-interact/guides.html">Guides</a></li>
          <li><a href="/react-interact/docs.html">Docs</a></li>
          <li><a href="/react-interact">Github</a></li>
        </ul>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-md-3"><br/><br/>
          <ul>
            <li><a href="/react-interact/guides.html">Getting Started</a></li>
            <li><a href="/react-interact/guides_containers.html">Containers</a></li>
            <li><a href="/react-interact/guides_mutations.html">Mutations</a></li>
            <li><a href="/react-interact/guides_subresources.html">Subresources</a></li>
            <li><a href="/react-interact/guides_custom_interfaces.html">Custom Agents/Interfaces</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <div class="page-header">
            <h1>Mutations</h1>
          </div>
          <p>Reading data from the server is an important part of an application but when we want to add interactivity we need to be able to also mutate it.</p>
          <p>Interact gives us the power to perform CRUD operations on our resources defined by our containers by passing a prop <code>interact</code> to the wrapped component.</p>
          <p>The <code>interact</code> prop exposes a fluent API where resources can be mutated and read using CRUD operations (read, update, create, remove, list).</p>
          <h3>Create</h3>
          <p>In the below example a new Todo is created when we click the Add Todo button.</p>
          <pre><code class="javascript">import React, { Component } from 'react'
import { createContainer } from 'react-interact'

class TodoList extends Component {

  render() {
    return (
      &lt;div&gt;
        {this.props.todos.map(todo =&gt; `${todo.title}, `)}
        &lt;a onClick={this.handleAddTodo.bind(this)}&gt;Add Todo&lt;/a&gt;
      &lt;/div&gt;
    )
  },

  handleAddTodo() {
    this.props.interact.todos.create({
      title: 'New Todo',
    })
  },
}

export default createContainer(TodoList, {
  todos: '/api/v1/todos',
})
</code></pre><br/><br/>
          <h3>Update</h3>
          <p>In this example we update/toggle the <code>done</code> property of the clicked Todo.</p>
          <pre><code class="javascript">import React, { Component } from 'react'
import { createContainer } from 'react-interact'

class TodoList extends Component {

  render() {
    return (
      &lt;ul&gt;
        {this.props.todos.map(todo =&gt; {
          const onClick = this.handleUpdateTodo.bind(this, {
            id: todo.id,
            payload: {
              done: !todo.done,
            },
          })
          
          return (
            &lt;li key={todo.id}&gt;
              &lt;a onClick={onClick}&gt;{todo.title}&lt;/a&gt;
            &lt;/li&gt;
          )
        })}
      &lt;/ul&gt;
    )
  },

  handleUpdateTodo({id, payload}) {
    this.props.interact.todos({id}).update(payload)
  },
}

export default createContainer(TodoList, {
  todos: '/api/v1/todos',
})
</code></pre><br/><br/>
          <h3>Remove</h3>
          <p>This example shows how to remove a Todo when we click it.</p>
          <pre><code class="javascript">import React, { Component } from 'react'
import { createContainer } from 'react-interact'

class TodoList extends Component {

  render() {
    return (
      &lt;ul&gt;
        {this.props.todos.map(todo =&gt; {
          const onClick = this.handleRemoveTodo.bind(this, todo.id)
          
          return (
            &lt;li key={todo.id}&gt;
              &lt;a onClick={onClick}&gt;{todo.title}&lt;/a&gt;
            &lt;/li&gt;
          )
        })}
      &lt;/ul&gt;
    )
  },

  handleRemoveTodo(id) {
    this.props.interact.todos({id}).remove()
  },
}

export default createContainer(TodoList, {
  todos: '/api/v1/todos',
})
</code></pre><br/><br/>
          <h3>List</h3>
          <p>This example shows an example of typeahead functionality using the <code>list</code> method.</p>
          <pre><code class="javascript">import React, { Component } from 'react'
import { createContainer } from 'react-interact'

class TodoList extends Component {

  render() {
    return (
      &lt;div&gt;
        &lt;input onChange={this.handleSearch.bind(this)} /&gt;
        &lt;ul&gt;
          {this.state.todos.map(todo =&gt; (
            &lt;li key={todo.id}&gt;{todo.title}&lt;/li&gt;
          ))}
        &lt;/ul&gt;
      &lt;/div&gt;
    )
  },
    
  handleSearch(event) {
    this.props.interact
      .todos({query: {search: event.target.value}})
      .list((response, collection, done) =&gt; {
        this.setState({todos: response.body})
        done()
      })
  },

}

export default createContainer(TodoList, {
  todos: '/api/v1/todos',
})
</code></pre>
          <div class="callout callout-info">
            <h4>Info</h4>
            <p>The <code>list</code> method will not update the collection that gets passed as a prop to the wrapped component. If you wish to list and update the collection at the same time use the <code>fetch</code> method instead.</p>
          </div><br/><br/>
          <h3>TODO: Read</h3>
          <h3>TODO: Fetch Single</h3>
          <h3>TODO: Fetch Multiple</h3><br/><br/>
          <h3>Callbacks</h3>
          <p>What happens when mutating one object has an effect on other items in the collection? If for example we change the position of an item in a list, and on the backend we also update the positions of other items in the list - these other changes would need to be synced with the frontend.</p>
          <p>One way of doing this is sending another network request that retrieves the updated list of items. There are other ways but we will look at this way for illustration purposes.</p>
          <pre><code class="javascript">import React, { Component } from 'react'
import { createContainer } from 'react-interact'

class TodoList extends Component {

  render() {
    return (
      &lt;ul&gt;
        {
          this.props.todos
            .sort((a, b) =&gt; a.position - b.position)
            .map(todo =&gt; {
              const onClick = this.handleMoveTodoToTop.bind(this, todo)
              
              return (
                &lt;li key={todo.id}&gt;
                  &lt;a onClick={onClick}&gt;{todo.title}&lt;/a&gt;
                &lt;/li&gt;
              )
            })
        }
      &lt;/ul&gt;
    )
  },

  handleMoveTodoToTop(todo) {
    this.props.interact.todos({id}).update(
      {position: 0},
      (response, collection, updateCollection) =&gt; {
        this.props.interact.todos.fetch()
      }
    )
  },
}

export default createContainer(TodoList, {
  todos: '/api/v1/todos',
})
</code></pre><br/><br/>
          <h3>Queries</h3>
          <p>Query strings can also be added to request urls by specifying a query property on the object that is passed to the method that selects the item in the resource. Each key-value pair is mapped to the uri query string using <a href="https://github.com/ljharb/qs" target="_blank">qs</a> behind the scenes.</p>
          <pre><code class="javascript">import React, { Component } from 'react'
import { createContainer } from 'react-interact'

class TodoList extends Component {

  render() {
    return (
      &lt;div&gt;
        &lt;input onChange={this.handleSearch.bind(this)} /&gt;
        &lt;ul&gt;
          {
            this.props.todos.map(todo =&gt; (
              &lt;li key={todo.id}&gt;{todo.title}&lt;/li&gt;
            ))
          }
        &lt;/ul&gt;
      &lt;/div&gt;
    )
  },
  
  handleSearch(event) {
    this.props.interact.todos({id, query: {search: event.target.value}}).fetch()
  },
}

export default createContainer(TodoList, {
  todos: '/api/v1/todos',
})
</code></pre><br/><br/><a href="/react-interact/guides_subresources.html" class="btn btn-md btn-primary">Next: Subresources</a><br/><br/><br/><br/><br/><br/>
        </div>
      </div>
    </div>
  </body>
</html>